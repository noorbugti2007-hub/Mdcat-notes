<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - MDCAT Notes</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px;
        }
        .logout-btn { 
            padding: 10px 20px; 
            background: #dc3545; 
            color: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 5px;
        }
        .section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 5px;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 10px 0;
        }
        th, td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #ddd;
        }
        th { 
            background: #f8f9fa;
        }
        .approved { 
            color: green; 
            font-weight: bold;
        }
        .pending { 
            color: orange; 
            font-weight: bold;
        }
        .action-btn { 
            padding: 5px 10px; 
            margin: 0 5px; 
            border: none; 
            cursor: pointer; 
            border-radius: 3px;
        }
        .approve-btn { 
            background: #28a745; 
            color: white;
        }
        .reject-btn { 
            background: #dc3545; 
            color: white;
        }
        .stats { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 20px;
        }
        .stat-card { 
            background: #007bff; 
            color: white; 
            padding: 20px; 
            border-radius: 5px; 
            flex: 1; 
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë®‚Äçüíº Admin Panel - MDCAT Notes</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>Total Students</h3>
                <p id="totalStudents">0</p>
            </div>
            <div class="stat-card">
                <h3>Approved</h3>
                <p id="approvedStudents">0</p>
            </div>
            <div class="stat-card">
                <h3>Pending</h3>
                <p id="pendingStudents">0</p>
            </div>
        </div>

        <div class="section">
            <h3>üìã Student Management</h3>
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Registration Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="studentsList">
                    <!-- Students will be listed here -->
                </tbody>
            </table>
        </div>

        <div class="section">
            <h3>üìÅ Upload Notes & Files</h3>
            <input type="file" id="fileUpload" multiple>
            <button onclick="uploadFiles()">Upload Files</button>
            <p><strong>Note:</strong> For full file upload functionality, you need backend server.</p>
            <p>For now, you can use Google Drive links in your notes.</p>
            
            <div style="margin-top: 20px;">
                <h4>Add Note Links:</h4>
                <input type="text" id="noteTitle" placeholder="Note Title" style="width: 200px;">
                <input type="text" id="noteLink" placeholder="Google Drive Link" style="width: 300px;">
                <button onclick="addNoteLink()">Add Note</button>
            </div>
        </div>

        <div class="section">
            <h3>üìä Student Access Logs</h3>
            <table>
                <thead>
                    <tr>
                        <th>Student Email</th>
                        <th>Login Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="accessLogs">
                    <!-- Access logs will appear here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    
    <script>
        // Check if admin is logged in
        if(!localStorage.getItem('adminLoggedIn')) {
            window.location.href = 'index.html';
        }

        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDiaB_xqiv5kGPusW71LQb_6XTIDo_kgoE",
            authDomain: "mdcat-notes-86e0e.firebaseapp.com",
            projectId: "mdcat-notes-86e0e",
            storageBucket: "mdcat-notes-86e0e.firebasestorage.app",
            messagingSenderId: "616541948794",
            appId: "1:616541948794:web:07799e7537edc37897a4c3"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Load students
        function loadStudents() {
            db.collection('students').onSnapshot(snapshot => {
                const studentsList = document.getElementById('studentsList');
                studentsList.innerHTML = '';
                
                let total = 0;
                let approved = 0;
                let pending = 0;

                snapshot.forEach(doc => {
                    const student = doc.data();
                    total++;
                    if(student.status === 'approved') approved++;
                    if(student.status === 'pending') pending++;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.email}</td>
                        <td class="${student.status}">${student.status.toUpperCase()}</td>
                        <td>${student.createdAt?.toDate().toLocaleDateString() || 'N/A'}</td>
                        <td>
                            ${student.status === 'pending' ? 
                                `<button class="action-btn approve-btn" onclick="approveStudent('${doc.id}')">Approve</button>
                                 <button class="action-btn reject-btn" onclick="rejectStudent('${doc.id}')">Reject</button>` : 
                                '<span>Approved</span>'
                            }
                        </td>
                    `;
                    studentsList.appendChild(row);
                });

                document.getElementById('totalStudents').textContent = total;
                document.getElementById('approvedStudents').textContent = approved;
                document.getElementById('pendingStudents').textContent = pending;
            });
        }

        function approveStudent(studentId) {
            db.collection('students').doc(studentId).update({
                status: 'approved',
                approvedAt: new Date()
            });
        }

        function rejectStudent(studentId) {
            db.collection('students').doc(studentId).delete();
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'index.html';
        }

        function uploadFiles() {
            alert('For full file upload, upgrade to paid hosting later. Use Google Drive links for now.');
        }

        function addNoteLink() {
            const title = document.getElementById('noteTitle').value;
            const link = document.getElementById('noteLink').value;
            if(title && link) {
                db.collection('notes').add({
                    title: title,
                    link: link,
                    createdAt: new Date()
                });
                alert('Note added successfully!');
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteLink').value = '';
            } else {
                alert('Please fill both title and link!');
            }
        }

        // Load students when page loads
        loadStudents();
    </script>
</body>
</html>
